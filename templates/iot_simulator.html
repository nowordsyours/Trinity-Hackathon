<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¨ IoT Sensor Simulator - Smart Toilet System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .simulator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .sensor-simulator {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }
        
        .sensor-simulator:hover {
            transform: translateY(-5px);
        }
        
        .sensor-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .sensor-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 15px;
        }
        
        .sensor-title {
            flex: 1;
        }
        
        .sensor-title h3 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .sensor-title p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .current-value {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .simulation-controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .scenario-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .scenario-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .scenario-clean {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
        }
        
        .scenario-moderate {
            background: linear-gradient(45deg, #FF9800, #FFC107);
            color: white;
        }
        
        .scenario-dirty {
            background: linear-gradient(45deg, #f44336, #E91E63);
            color: white;
        }
        
        .scenario-emergency {
            background: linear-gradient(45deg, #9C27B0, #673AB7);
            color: white;
        }
        
        .scenario-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .status-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .status-active {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
        }
        
        .status-inactive {
            background: #f44336;
            color: white;
        }
        
        .data-stream {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .stream-entry {
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .stream-timestamp {
            color: #666;
            font-size: 0.8rem;
        }
        
        .stream-data {
            color: #333;
        }
        
        .prediction-result {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            margin-top: 20px;
        }
        
        .hygiene-score-display {
            text-align: center;
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hygiene-status-display {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 25px;
            display: inline-block;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .status-clean {
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
        }
        
        .status-moderate {
            background: linear-gradient(45deg, #FF9800, #FFC107);
            color: white;
        }
        
        .status-dirty {
            background: linear-gradient(45deg, #f44336, #E91E63);
            color: white;
        }
        
        @media (max-width: 768px) {
            .simulator-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .scenario-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ IoT Sensor Simulator</h1>
            <p>Real-time Smart Toilet Monitoring System</p>
            <div class="status-indicator status-active">üü¢ Simulation Active</div>
        </div>
        
        <!-- Simulation Controls -->
        <div class="simulation-controls">
            <h2>üéÆ Quick Scenarios</h2>
            <p>Click to simulate different toilet conditions instantly:</p>
            <div class="scenario-buttons">
                <button class="scenario-btn scenario-clean" onclick="loadScenario('clean')">
                    üßº Clean Toilet
                </button>
                <button class="scenario-btn scenario-moderate" onclick="loadScenario('moderate')">
                    ‚ö†Ô∏è Moderate Condition
                </button>
                <button class="scenario-btn scenario-dirty" onclick="loadScenario('dirty')">
                    üö® Dirty Toilet
                </button>
                <button class="scenario-btn scenario-emergency" onclick="loadScenario('emergency')">
                    üÜò Emergency Alert
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-primary" onclick="startAutoSimulation()">
                    ‚ñ∂Ô∏è Start Auto Simulation
                </button>
                <button class="btn btn-secondary" onclick="stopAutoSimulation()">
                    ‚èπÔ∏è Stop Simulation
                </button>
                <button class="btn btn-secondary" onclick="randomizeAll()">
                    üé≤ Randomize All
                </button>
            </div>
        </div>
        
        <!-- Sensor Simulators -->
        <div class="simulator-grid" id="sensor-simulators">
            <!-- Dynamic sensor simulators will be inserted here -->
        </div>
        
        <!-- Prediction Results -->
        <div class="prediction-result" id="prediction-result" style="display: none;">
            <h2>üéØ Hygiene Prediction Results</h2>
            <div class="hygiene-score-display" id="hygiene-score">--</div>
            <div style="text-align: center;">
                <span class="hygiene-status-display" id="hygiene-status">Loading...</span>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <small id="confidence">Confidence: --%</small>
            </div>
            <div id="explanation" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                <!-- Explanation will be inserted here -->
            </div>
        </div>
        
        <!-- Data Stream -->
        <div class="prediction-result">
            <h2>üì° Real-time Data Stream</h2>
            <div class="data-stream" id="data-stream">
                <div class="stream-entry">
                    <span class="stream-timestamp">Ready to start simulation...</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let sensorData = {};
        let autoSimulationInterval = null;
        let streamInterval = null;
        
        const sensorConfig = {
            'ammonia': { 
                icon: '‚òÅÔ∏è', 
                color: '#f44336', 
                min: 0, 
                max: 100, 
                unit: 'ppm',
                description: 'Ammonia gas concentration'
            },
            'methane': { 
                icon: 'üí®', 
                color: '#9C27B0', 
                min: 0, 
                max: 100, 
                unit: 'ppm',
                description: 'Methane gas levels'
            },
            'humidity': { 
                icon: 'üíß', 
                color: '#2196F3', 
                min: 30, 
                max: 90, 
                unit: '%',
                description: 'Relative humidity'
            },
            'temperature': { 
                icon: 'üå°Ô∏è', 
                color: '#FF9800', 
                min: 15, 
                max: 45, 
                unit: '¬∞C',
                description: 'Ambient temperature'
            },
            'footfall': { 
                icon: 'üë•', 
                color: '#4CAF50', 
                min: 0, 
                max: 50, 
                unit: 'people/hr',
                description: 'People count per hour'
            },
            'water_flow': { 
                icon: 'üí¶', 
                color: '#00BCD4', 
                min: 0, 
                max: 30, 
                unit: 'L/min',
                description: 'Water flow rate'
            },
            'ph': { 
                icon: '‚öñÔ∏è', 
                color: '#E91E63', 
                min: 4, 
                max: 9, 
                unit: 'pH',
                description: 'Water pH level'
            },
            'turbidity': { 
                icon: 'üå´Ô∏è', 
                color: '#795548', 
                min: 0, 
                max: 500, 
                unit: 'NTU',
                description: 'Water turbidity'
            }
        };
        
        // Initialize sensor simulators
        function initializeSensors() {
            const container = document.getElementById('sensor-simulators');
            container.innerHTML = '';
            
            Object.entries(sensorConfig).forEach(([sensor, config]) => {
                const simulator = createSensorSimulator(sensor, config);
                container.appendChild(simulator);
                
                // Initialize with random value
                sensorData[sensor] = Math.random() * (config.max - config.min) + config.min;
                updateSensorDisplay(sensor, sensorData[sensor]);
            });
        }
        
        function createSensorSimulator(sensor, config) {
            const div = document.createElement('div');
            div.className = 'sensor-simulator';
            div.innerHTML = `
                <div class="sensor-header">
                    <div class="sensor-icon" style="background: ${config.color}20; color: ${config.color}">
                        ${config.icon}
                    </div>
                    <div class="sensor-title">
                        <h3>${sensor.charAt(0).toUpperCase() + sensor.slice(1)}</h3>
                        <p>${config.description}</p>
                    </div>
                </div>
                <div class="current-value" id="value-${sensor}" style="color: ${config.color}">
                    --
                </div>
                <div class="controls">
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Min: ${config.min}</span>
                            <span>Max: ${config.max}</span>
                        </div>
                        <input type="range" 
                               class="slider" 
                               id="slider-${sensor}"
                               min="${config.min}" 
                               max="${config.max}" 
                               step="0.1"
                               oninput="updateSensorValue('${sensor}', this.value)">
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="randomizeSensor('${sensor}')">
                        üé≤ Random
                    </button>
                    <button class="btn btn-secondary" onclick="resetSensor('${sensor}')">
                        üîÑ Reset
                    </button>
                </div>
            `;
            return div;
        }
        
        function updateSensorValue(sensor, value) {
            sensorData[sensor] = parseFloat(value);
            updateSensorDisplay(sensor, sensorData[sensor]);
            updatePrediction();
        }
        
        function updateSensorDisplay(sensor, value) {
            const config = sensorConfig[sensor];
            const valueElement = document.getElementById(`value-${sensor}`);
            valueElement.innerHTML = `
                ${value.toFixed(1)} <small>${config.unit}</small>
            `;
            
            // Update slider
            const slider = document.getElementById(`slider-${sensor}`);
            if (slider) {
                slider.value = value;
            }
        }
        
        function randomizeSensor(sensor) {
            const config = sensorConfig[sensor];
            const value = Math.random() * (config.max - config.min) + config.min;
            updateSensorValue(sensor, value);
        }
        
        function resetSensor(sensor) {
            const config = sensorConfig[sensor];
            const defaultValue = (config.min + config.max) / 2;
            updateSensorValue(sensor, defaultValue);
        }
        
        function randomizeAll() {
            Object.keys(sensorConfig).forEach(sensor => {
                randomizeSensor(sensor);
            });
        }
        
        function loadScenario(scenario) {
            const scenarios = {
                'clean': {
                    'ammonia': 15, 'methane': 10, 'humidity': 45, 'temperature': 22,
                    'footfall': 5, 'water_flow': 25, 'ph': 7.0, 'turbidity': 20
                },
                'moderate': {
                    'ammonia': 45, 'methane': 35, 'humidity': 65, 'temperature': 24,
                    'footfall': 20, 'water_flow': 15, 'ph': 7.2, 'turbidity': 80
                },
                'dirty': {
                    'ammonia': 85, 'methane': 75, 'humidity': 80, 'temperature': 28,
                    'footfall': 35, 'water_flow': 5, 'ph': 8.5, 'turbidity': 180
                },
                'emergency': {
                    'ammonia': 95, 'methane': 90, 'humidity': 85, 'temperature': 32,
                    'footfall': 45, 'water_flow': 1, 'ph': 9.0, 'turbidity': 450
                }
            };
            
            if (scenarios[scenario]) {
                Object.entries(scenarios[scenario]).forEach(([sensor, value]) => {
                    updateSensorValue(sensor, value);
                });
                
                addToStream(`üéØ Scenario loaded: ${scenario.toUpperCase()} toilet conditions`);
            }
        }
        
        function startAutoSimulation() {
            if (autoSimulationInterval) {
                clearInterval(autoSimulationInterval);
            }
            
            autoSimulationInterval = setInterval(() => {
                // Simulate realistic variations
                Object.keys(sensorData).forEach(sensor => {
                    const currentValue = sensorData[sensor];
                    const config = sensorConfig[sensor];
                    const variation = (Math.random() - 0.5) * (config.max - config.min) * 0.1;
                    let newValue = currentValue + variation;
                    
                    // Keep within bounds
                    newValue = Math.max(config.min, Math.min(config.max, newValue));
                    
                    updateSensorValue(sensor, newValue);
                });
            }, 2000);
            
            // Start data stream
            if (streamInterval) {
                clearInterval(streamInterval);
            }
            
            streamInterval = setInterval(() => {
                addToStream(`üìä Auto-simulation running... ${new Date().toLocaleTimeString()}`);
            }, 5000);
            
            addToStream('‚ñ∂Ô∏è Auto-simulation started');
        }
        
        function stopAutoSimulation() {
            if (autoSimulationInterval) {
                clearInterval(autoSimulationInterval);
                autoSimulationInterval = null;
            }
            
            if (streamInterval) {
                clearInterval(streamInterval);
                streamInterval = null;
            }
            
            addToStream('‚èπÔ∏è Auto-simulation stopped');
        }
        
        function addToStream(message) {
            const stream = document.getElementById('data-stream');
            const entry = document.createElement('div');
            entry.className = 'stream-entry';
            entry.innerHTML = `
                <span class="stream-timestamp">${new Date().toLocaleTimeString()}</span>
                <span class="stream-data">${message}</span>
            `;
            
            stream.insertBefore(entry, stream.firstChild);
            
            // Keep only last 20 entries
            while (stream.children.length > 20) {
                stream.removeChild(stream.lastChild);
            }
        }
        
        async function updatePrediction() {
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(sensorData)
                });
                
                const result = await response.json();
                
                if (result.hygiene_score) {
                    displayPrediction(result);
                }
            } catch (error) {
                console.error('Error getting prediction:', error);
            }
        }
        
        function displayPrediction(prediction) {
            const resultDiv = document.getElementById('prediction-result');
            resultDiv.style.display = 'block';
            
            document.getElementById('hygiene-score').textContent = 
                Math.round(prediction.hygiene_score);
            
            const statusElement = document.getElementById('hygiene-status');
            statusElement.textContent = prediction.hygiene_status;
            statusElement.className = `hygiene-status-display status-${prediction.hygiene_status.toLowerCase()}`;
            
            document.getElementById('confidence').textContent = 
                `Confidence: ${Math.round(prediction.confidence * 100)}%`;
            
            document.getElementById('explanation').innerHTML = 
                `<strong>Analysis:</strong> ${prediction.explanation}`;
            
            addToStream(`üéØ Prediction: ${prediction.hygiene_status} (Score: ${Math.round(prediction.hygiene_score)})`);
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeSensors();
            
            // Load moderate scenario by default
            setTimeout(() => {
                loadScenario('moderate');
            }, 1000);
            
            addToStream('üî¨ IoT Sensor Simulator initialized');
        });
    </script>
</body>
</html>